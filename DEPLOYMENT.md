# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹é †æ›¸

## ğŸ¯ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Xã‚µãƒ¼ãƒãƒ¼ã¸ã®æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [äº‹å‰æº–å‚™](#äº‹å‰æº–å‚™)
2. [Xã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š](#xã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š)
3. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
4. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
5. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## äº‹å‰æº–å‚™

### å¿…è¦ãªã‚‚ã®

- Xã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³ä»¥ä¸Šæ¨å¥¨ï¼‰
- SSHæ¥ç¶šæƒ…å ±ï¼ˆãƒ›ã‚¹ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
- ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆä¾‹: yourphoto.comï¼‰
- Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæœ¬ç•ªç”¨ï¼‰

### Xã‚µãƒ¼ãƒãƒ¼è¦ä»¶ç¢ºèª

1. ã‚µãƒ¼ãƒãƒ¼ãƒ‘ãƒãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³
2. Node.jså¯¾å¿œã‚’ç¢ºèªï¼ˆã‚µãƒ¼ãƒãƒ¼æƒ…å ± > Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
3. å¿…è¦ã«å¿œã˜ã¦Node.js 18ä»¥ä¸Šã‚’æœ‰åŠ¹åŒ–

---

## Xã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š

### 1. SSHæ¥ç¶š

```bash
ssh your-username@your-server.xsrv.jp
```

### 2. Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª

```bash
node -v  # v18ä»¥ä¸Šæ¨å¥¨
npm -v
```

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„å ´åˆã€Xã‚µãƒ¼ãƒãƒ¼ãƒ‘ãƒãƒ«ã‹ã‚‰è¨­å®šå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

### 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ

```bash
cd ~/your-domain.com
mkdir -p app/{frontend,backend}
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: Xã‚µãƒ¼ãƒãƒ¼ã§é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°

#### ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰

```bash
cd frontend
npm install
npm run build
```

#### Xã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```bash
# SCPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
scp -r dist/* your-username@your-server.xsrv.jp:~/your-domain.com/public_html/
```

#### ã¾ãŸã¯ã€FTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆFileZillaç­‰ï¼‰ã‚’ä½¿ç”¨

1. `frontend/dist/` ã®å†…å®¹ã‚’ `public_html/` ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: Vercel / Netlifyï¼ˆæ¨å¥¨ï¼‰

#### Vercelã®å ´åˆ

1. Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼š
   - Framework: Vite
   - Root Directory: `frontend`
   - Build Command: `npm run build`
   - Output Directory: `dist`

3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
   ```
   VITE_SUPABASE_URL=https://your-project.supabase.co
   VITE_SUPABASE_ANON_KEY=your-anon-key
   VITE_API_URL=https://api.yourphoto.com/api
   VITE_DEFAULT_SHOP_ID=1
   ```

4. ãƒ‡ãƒ—ãƒ­ã‚¤

#### Netlifyã®å ´åˆ

1. Netlifyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
2. ãƒ“ãƒ«ãƒ‰è¨­å®šï¼š
   - Base directory: `frontend`
   - Build command: `npm run build`
   - Publish directory: `frontend/dist`

3. ç’°å¢ƒå¤‰æ•°ã‚’åŒæ§˜ã«è¨­å®š
4. ãƒ‡ãƒ—ãƒ­ã‚¤

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### Gitã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```bash
cd ~/your-domain.com/app/backend
git clone https://github.com/your-repo/Photo-Studio-Pricing-Simulator.git .
cd backend
npm install
```

#### ã¾ãŸã¯ã€SCPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«
cd backend
npm install --production
npm run build

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
scp -r dist package.json package-lock.json node_modules \
  your-username@your-server.xsrv.jp:~/your-domain.com/app/backend/
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cd ~/your-domain.com/app/backend
nano .env
```

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```env
PORT=5000
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-production-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-production-service-key
FRONTEND_URL=https://yourphoto.com
NODE_ENV=production
```

### 3. PM2ã§å¸¸é§åŒ–

#### PM2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -g pm2
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

```bash
cd ~/your-domain.com/app/backend
pm2 start dist/server.js --name photo-simulator
pm2 save
pm2 startup  # èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆè¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼‰
```

#### PM2ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

```bash
pm2 status              # çŠ¶æ…‹ç¢ºèª
pm2 logs photo-simulator  # ãƒ­ã‚°ç¢ºèª
pm2 restart photo-simulator  # å†èµ·å‹•
pm2 stop photo-simulator     # åœæ­¢
pm2 delete photo-simulator   # å‰Šé™¤
```

### 4. Nginxãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

Xã‚µãƒ¼ãƒãƒ¼ã§ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼š

```nginx
# /etc/nginx/conf.d/your-domain.conf

server {
    listen 80;
    server_name api.yourphoto.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

Nginxå†èµ·å‹•ï¼š
```bash
sudo systemctl restart nginx
```

---

## SSLè¨¼æ˜æ›¸ã®è¨­å®š

### Let's Encryptã‚’ä½¿ç”¨

```bash
sudo certbot --nginx -d yourphoto.com -d api.yourphoto.com
```

è‡ªå‹•æ›´æ–°ç¢ºèªï¼š
```bash
sudo certbot renew --dry-run
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª

- `https://yourphoto.com` ã«ã‚¢ã‚¯ã‚»ã‚¹
- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª
- ãƒ—ãƒ©ãƒ³ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ç¢ºèª

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª

```bash
curl https://api.yourphoto.com/health
# æœŸå¾…çµæœ: {"status":"OK","timestamp":"..."}

curl https://api.yourphoto.com/api/simulator?shop=1
# æœŸå¾…çµæœ: JSONå½¢å¼ã®ãƒ—ãƒ©ãƒ³ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿
```

### 3. ç®¡ç†ç”»é¢ã®ç¢ºèª

- `https://yourphoto.com/login` ã«ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèª
- ãƒ—ãƒ©ãƒ³ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®CRUDæ“ä½œã‚’ç¢ºèª

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ãªã„

```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs photo-simulator

# ä¸€èˆ¬çš„ãªåŸå› :
# 1. ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
sudo lsof -i :5000

# 2. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„
cat .env

# 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒŸã‚¹
npm install
npm run build
pm2 restart photo-simulator
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

1. Supabase URLã¨ã‚­ãƒ¼ã‚’ç¢ºèª
2. Supabase RLSãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèª
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª

```bash
# æ¥ç¶šãƒ†ã‚¹ãƒˆ
curl https://your-project.supabase.co
```

### CORS ã‚¨ãƒ©ãƒ¼

`backend/src/server.ts` ã®CORSè¨­å®šã‚’ç¢ºèªï¼š

```typescript
app.use(cors({
  origin: 'https://yourphoto.com',  // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®URL
  credentials: true,
}))
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰APIã«æ¥ç¶šã§ããªã„

1. `.env.local` / Vercelç’°å¢ƒå¤‰æ•°ã§ `VITE_API_URL` ã‚’ç¢ºèª
2. APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
3. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª

---

## å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ­ã‚°ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```bash
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

```bash
# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°
npm outdated
npm update

# è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
npm audit
npm audit fix
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆSupabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ï¼‰
# 1. Database > Backups
# 2. å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æœ‰åŠ¹åŒ–

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cd ~/your-domain.com
tar -czf backup-$(date +%Y%m%d).tar.gz app/
```

---

## ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### è² è·ãŒé«˜ã„å ´åˆ

1. **PM2ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰**
   ```bash
   pm2 start dist/server.js -i max --name photo-simulator
   ```

2. **CDNå°å…¥**
   - Cloudflareã¾ãŸã¯AWS CloudFront

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**
   - Supabaseã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
   - ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–

---

## ã‚µãƒãƒ¼ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤ã«é–¢ã™ã‚‹å•é¡Œã¯ã€GitHubã®Issuesã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚

- Xã‚µãƒ¼ãƒãƒ¼å…¬å¼ã‚µãƒãƒ¼ãƒˆ: https://www.xserver.ne.jp/support/
- Supabaseãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://supabase.com/docs
